<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>持续集成：使用 GitHub Actions 来帮你的应用自动化部署到 GitHub Pages | LeoKu&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.7.0">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="在你每次对代码变动时，都要手动执行 npm run build 操作来构建文件，然后再将构建好的文件推送到 gh-pages 分支来重新部署 GitHub Pages。这些操作是一成不变且耗时耗力的，那么能否让机器替代我们来执行它们，好让部署变得“水到渠成”呢？">
    
    <link rel="preload" href="/assets/css/0.styles.191dfe9b.css" as="style"><link rel="preload" href="/assets/js/app.8d009275.js" as="script"><link rel="preload" href="/assets/js/4.ca8ae4a6.js" as="script"><link rel="preload" href="/assets/js/1.bdc9bb95.js" as="script"><link rel="preload" href="/assets/js/14.09338fe2.js" as="script"><link rel="prefetch" href="/assets/js/10.edc74c6d.js"><link rel="prefetch" href="/assets/js/11.5699bc5a.js"><link rel="prefetch" href="/assets/js/12.c1495f0a.js"><link rel="prefetch" href="/assets/js/13.9c2ca07e.js"><link rel="prefetch" href="/assets/js/15.ecd8d4ae.js"><link rel="prefetch" href="/assets/js/16.316e3b14.js"><link rel="prefetch" href="/assets/js/17.ce5193b4.js"><link rel="prefetch" href="/assets/js/18.088fba17.js"><link rel="prefetch" href="/assets/js/19.40abc568.js"><link rel="prefetch" href="/assets/js/20.44090e46.js"><link rel="prefetch" href="/assets/js/3.ee20587a.js"><link rel="prefetch" href="/assets/js/5.d1d23781.js"><link rel="prefetch" href="/assets/js/6.a21a75f3.js"><link rel="prefetch" href="/assets/js/7.8d6bf491.js"><link rel="prefetch" href="/assets/js/8.ceaf8eab.js"><link rel="prefetch" href="/assets/js/9.e4a12637.js">
    <link rel="stylesheet" href="/assets/css/0.styles.191dfe9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar navbar-blog"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" style="fill:currentColor;transform:;-ms-filter:;"><path d="M4 11H16V13H4zM4 6H20V8H4zM4 18L11 18 11.235 18 11.235 16 11 16 4 16z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="LeoKu's Blog" class="logo"> <span class="site-name can-hide">LeoKu's Blog</span></a> <div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  Project
</a></div> <a href="https://github.com/Codennnn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
  </a></nav></div> <div class="external-links-search"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  About
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  Project
</a></div> <a href="https://github.com/Codennnn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
  </a></nav>  <ul class="sidebar-links"><li><a href="/blog/develop-your-code-specification.html" class="sidebar-link">制定你的代码规范</a></li><li><a href="/blog/to-oak.html" class="sidebar-link">致橡树</a></li><li><a href="/blog/deploy-vue-app-to-github-pages.html" class="sidebar-link">如何将 Vue 应用部署到 GitHub Pages</a></li><li><a href="/blog/ci-cd-with-github-actions-to-deploy-on-github-pages.html" aria-current="page" class="active sidebar-link">持续集成：使用 GitHub Actions 来帮你的应用自动化部署到 GitHub Pages</a></li><li><a href="/blog/use-gitee-as-image-bed.html" class="sidebar-link">如何使用码云作为免费图床</a></li></ul> </aside> <main class="blog"><section class="blog-list" style="display:none;" data-v-1492c301><div class="container" data-v-1492c301><div class="page-title" data-v-1492c301><h1 class="title" data-v-1492c301>持续集成：使用 GitHub Actions 来帮你的应用自动化部署到 GitHub Pages</h1></div> <div class="articles" data-v-1492c301><article class="blog-item" data-v-1492c301><a href="/blog/develop-your-code-specification.html" class="blog-link" data-v-1492c301><h3 class="blog-item__title" data-v-1492c301>制定你的代码规范</h3> <p class="blog-item__desc" data-v-1492c301>为你的项目加上规范</p> <div class="blog-item__more" data-v-1492c301>
            查看全文
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:currentColor;transform:translateY(5px);-ms-filter:;" data-v-1492c301><path d="M11.293 17.293L12.707 18.707 19.414 12 12.707 5.293 11.293 6.707 15.586 11 6 11 6 13 15.586 13z"></path></svg></div></a></article><article class="blog-item" data-v-1492c301><a href="/blog/to-oak.html" class="blog-link" data-v-1492c301><h3 class="blog-item__title" data-v-1492c301>致橡树</h3> <p class="blog-item__desc" data-v-1492c301>这是一首我很喜欢的当代诗歌</p> <div class="blog-item__more" data-v-1492c301>
            查看全文
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:currentColor;transform:translateY(5px);-ms-filter:;" data-v-1492c301><path d="M11.293 17.293L12.707 18.707 19.414 12 12.707 5.293 11.293 6.707 15.586 11 6 11 6 13 15.586 13z"></path></svg></div></a></article><article class="blog-item" data-v-1492c301><a href="/blog/deploy-vue-app-to-github-pages.html" class="blog-link" data-v-1492c301><h3 class="blog-item__title" data-v-1492c301>如何将 Vue 应用部署到 GitHub Pages</h3> <p class="blog-item__desc" data-v-1492c301>当你完成了一个只有静态内容的网站如个人博客或网页模板，你想发布到网络上供别人访问。通常你需要部署到一个 Http 服务器上，比如阿里云、腾讯云等市场上各种云服务器，然而单独维护一个服务器付出的精力和金钱是巨大的，而 GitHub Pages 完全能胜任这项工作</p> <div class="blog-item__more" data-v-1492c301>
            查看全文
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:currentColor;transform:translateY(5px);-ms-filter:;" data-v-1492c301><path d="M11.293 17.293L12.707 18.707 19.414 12 12.707 5.293 11.293 6.707 15.586 11 6 11 6 13 15.586 13z"></path></svg></div></a></article><article class="blog-item" data-v-1492c301><a href="/blog/ci-cd-with-github-actions-to-deploy-on-github-pages.html" aria-current="page" class="blog-link router-link-exact-active router-link-active" data-v-1492c301><h3 class="blog-item__title" data-v-1492c301>持续集成：使用 GitHub Actions 来帮你的应用自动化部署到 GitHub Pages</h3> <p class="blog-item__desc" data-v-1492c301>在你每次对代码变动时，都要手动执行 npm run build 操作来构建文件，然后再将构建好的文件推送到 gh-pages 分支来重新部署 GitHub Pages。这些操作是一成不变且耗时耗力的，那么能否让机器替代我们来执行它们，好让部署变得“水到渠成”呢？</p> <div class="blog-item__more" data-v-1492c301>
            查看全文
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:currentColor;transform:translateY(5px);-ms-filter:;" data-v-1492c301><path d="M11.293 17.293L12.707 18.707 19.414 12 12.707 5.293 11.293 6.707 15.586 11 6 11 6 13 15.586 13z"></path></svg></div></a></article><article class="blog-item" data-v-1492c301><a href="/blog/use-gitee-as-image-bed.html" class="blog-link" data-v-1492c301><h3 class="blog-item__title" data-v-1492c301>如何使用码云作为免费图床</h3> <p class="blog-item__desc" data-v-1492c301>本文将介绍如何访问存储在码云上的图片以实现图床</p> <div class="blog-item__more" data-v-1492c301>
            查看全文
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" style="fill:currentColor;transform:translateY(5px);-ms-filter:;" data-v-1492c301><path d="M11.293 17.293L12.707 18.707 19.414 12 12.707 5.293 11.293 6.707 15.586 11 6 11 6 13 15.586 13z"></path></svg></div></a></article></div></div></section> <section class="blog-content" data-v-02f52932><div class="theme-default-content content__default" data-v-02f52932><h1>持续集成：使用 GitHub Actions 来帮你的应用自动化部署到 GitHub Pages</h1> <p>前文我们介绍了<a href="/blog/deploy-vue-app-to-github-pages">如何将 Vue 应用部署到 GitHub Pages</a>，考虑以下场景：在你每次对代码变动时，都要手动执行 <code>npm run build</code> 操作来构建文件，然后再将构建好的文件推送到 <code>gh-pages</code> 分支来重新部署 GitHub Pages。这些操作是一成不变且耗时耗力的，那么能否让机器替代我们来执行它们，好让部署变得“水到渠成”呢？本文将介绍如何使用 <a href="https://github.com/features/actions" target="_blank" rel="noopener noreferrer">GitHub Actions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来解放我们枯燥的工作。</p> <p>请注意，本文不是 GitHub Actions 的教程，如果你还不熟悉什么是 GitHub Actions，不妨读一读阮一峰的 <a href="http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html" target="_blank" rel="noopener noreferrer">GitHub Actions 入门教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <h3 id="_1-创建个人访问令牌"><a href="#_1-创建个人访问令牌" class="header-anchor">#</a> 1.创建个人访问令牌</h3> <p>首先，你要创建一个用于授权 GitHub Actions 的标识，这就是个人访问令牌（personal access tokens）。关于如何创建这个令牌，请参考官方的<a href="https://docs.github.com/cn/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">这篇教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。请务必正确创建，因为接下来的配置中要用到。</p> <h3 id="_2-创建我们的工作流"><a href="#_2-创建我们的工作流" class="header-anchor">#</a> 2.创建我们的工作流</h3> <p>在项目的根目录下创建这样的目录：<code>.github/workflows</code>，然后在这个目录下面新建一个 <code>.yml</code> 文件，文件名可以任意取，比如 <code>deploy.yml</code>。</p> <p>文件的内容参考如下：</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token comment"># workflow 的名称。如果省略则默认为当前 workflow 的文件名</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> Venus CI/CD

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">push</span><span class="token punctuation">:</span>
    <span class="token key atrule">branches</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> main

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">venus-cicd</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> Build &amp; deploy venus
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest <span class="token comment"># 使用最新的 Ubuntu 系统作为编译部署的环境</span>

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout codes
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2.3.4

    <span class="token comment"># 设置 node.js 运行环境</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Setup node
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v2.1.2
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">'12.x'</span>

    <span class="token comment"># 设置缓存依赖，加快下次安装依赖的速度</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cache node modules
      <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/cache@v2.1.3
      <span class="token key atrule">with</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">'**/node_modules'</span>
        <span class="token key atrule">key</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> runner.os <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>node<span class="token punctuation">-</span>$<span class="token punctuation">{</span><span class="token punctuation">{</span> hashFiles('<span class="token important">**/yarn.lock')</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>

    <span class="token comment"># 安装依赖</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
      <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn install

    <span class="token comment"># 构建文件</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate files
      <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn build

    <span class="token comment"># 将构建后的文件推送到 gh-pages</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push to gh<span class="token punctuation">-</span>pages
      <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token comment"># 填写项目所在仓库地址</span>
        <span class="token key atrule">GITHUB_REPO</span><span class="token punctuation">:</span> github.com/Chinesee/venus.git
      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        cd ./dist
        git init
        git config --local user.name &quot;LeoKu&quot;
        git config --local user.email &quot;czc12580520@gmail.com&quot;
        git add .
        git commit -m &quot;GitHub Actions Auto Builder at $(date +'%Y-%m-%d %H:%M:%S')&quot;
        git push --force --quiet &quot;https://${{ secrets.ACCESS_TOKEN }}@$GITHUB_REPO&quot; HEAD:gh-pages</span>
</code></pre></div><h2 id="自动化部署"><a href="#自动化部署" class="header-anchor">#</a> 自动化部署</h2> <p>完成了以上两个步骤，以后每当你将代码推送到 <code>main</code> 分支时，都会触发 GitHub Actions 来执行工作流。</p> <p>GitHub Actions 任务列表：</p> <p><img src="https://gitee.com/chinesee/images/raw/master/blog/5.png" alt="GitHub Actions 任务列表"></p> <p>GitHub Actions 任务详情：</p> <p><img src="https://gitee.com/chinesee/images/raw/master/blog/6.png" alt="GitHub Actions 任务详情"></p></div></section></main> <div class="footer" data-v-7bcc863b>
  Made with
  <a href="https://vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer" class="vuepress-link" data-v-7bcc863b>Vuepress</a></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8d009275.js" defer></script><script src="/assets/js/4.ca8ae4a6.js" defer></script><script src="/assets/js/1.bdc9bb95.js" defer></script><script src="/assets/js/14.09338fe2.js" defer></script>
  </body>
</html>
